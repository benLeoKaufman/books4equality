<% layout('../layout') -%>

<script src="/bower_components/handlebars/handlebars.min.js"></script>

ISBN
<input type="text" id="isbn">
<a id="search" class='btn btn-link'>Search ISBN</a>

<br>
<br>

<script id="entry-template" type="text/x-handlebars-template">
<!-- XXX use div & css layout-->
<table>
  <tr>
    <td>
      <img src="{{book.imageLinks.thumbnail}}" />
      &nbsp;&nbsp;
    </td>
    <td>
      <span><strong>{{book.title}}</strong> ({{book.publishedDate}})</span>
      <br>
      {{#each book.authors}}
        <em>{{this}}</em>
      {{/each}}
      <br>
      <br>

      <form id="form_book" method="post" action="/admin/books">
        <!-- XXX could be sent with ajax for a better UX -->
        <input type="hidden" name="isbn" value="{{isbn}}" required>
        <input type="submit" class='btn btn-primary' value="Register this book"></input>
      </form>
    </td>
  </tr>
</table>
</script>

<div id="results"></div>

<script>
$(function() {
    var source = $("#entry-template").html();
    var template = Handlebars.compile(source);

    $("#search").click(function() {
        var isbn = $("#isbn").val();
        if (!isbn) {
            return false;
        }

        $.getJSON('/admin/search/' + isbn)
            .done(function(book) {
                var html = template({book: book, isbn: isbn});
                $("#results").html(html);
            })
            .fail(function(data, status, xhr) {
                $("#results").html('<p class="text-warning">Book with ISBN ' + isbn + ' not found</p>');
            });
    });
});
</script>
